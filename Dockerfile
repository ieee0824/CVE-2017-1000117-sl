FROM golang:1.8.3-alpine3.6

WORKDIR /go/src/github.com/ieee0824/CVE-2017-1000117-sl

RUN set -e \
	&& apk update \
	&& apk add gzip

RUN set -e \
	&& echo "#!/bin/ash" >> /bin/build.sh \
	&& echo "set -ex" >> /bin/build.sh \
	&& echo "CGO_ENABLED=0 GOOS=linux go build" >> /bin/build.sh \
	&& echo "mv CVE-2017-1000117-sl sl-Linux" >> /bin/build.sh \
	&& echo "GOOS=darwin go build" >> /bin/build.sh \
	&& echo "mv CVE-2017-1000117-sl sl-Darwin" >> /bin/build.sh \
	&& echo "tar zcvf sl.tar.gz sl-Darwin sl-Linux" >> /bin/build.sh \
	&& echo "rm -rf sl-Drawin sl-Linux" >> /bin/build.sh \
	&& chmod +x /bin/build.sh \
	&& ls


CMD ["build.sh"]
